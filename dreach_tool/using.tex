\section{Using \dReach{}}\label{sec:using-dreach}
% We now describe the input format and command line options of
% \dReach{}.
\subsection{Input Format}\label{sec:input-format}
The input format for describing hybrid systems and reachability properties consists of five
sections: macro definitions, variable declarations, mode definitions,
and initial condition, and goals. 

\noindent$\bullet$
In macro definitions, we allows users to define macros in C
preprocessor (\texttt{cpp}) style which can be used in the following
sections. Macro expansions occur before the other parts are processed.

\noindent$\bullet$
	A variable declaration specifies a real variable, $var$ and its domain
$[l, u]$ which is in Real interval $\mathbb{IR}$. \drh{} requires a
special declaration for \textit{time} variable, to specify the
upperbound of time duration in the analysis of bounded
$\delta$-reachability.


\noindent$\bullet$ A mode definition consists of mode id, mode invariant, flow, and jump.
\textit{id} is a unique positive interger assigned to a mode. An
invariant is a conjuction of logic formulae which must always hold in
a mode. A flow describes a continuous dynamics of a mode by providing
a set of ordinary differential equations (\textit{ode}s). The first
formula of \textit{jump} is interpreted as a guard, a logic formula
specifying a condition to make a transition. Note that this allows a
transition but does not force it. The second argument of
\textit{jump}, $n$ denotes the target mode-id. The last one is
\textit{reset}, a logic formula connecting the old and new values for
the transition.

\noindent$\bullet$ \textit{initial-condition} specifies the initial mode of a hybrid
system and its initial configuration. \textit{goal} shares the same
syntactic structure of \textit{initial-condition}. It poses a
reachability question: ``Is there a trajectory of a hybrid system
reaching \textit{mode-id} while satisfying the goal condition
\textit{formula}?''.

Here is the syntax grammar of \drh{}:
\begin{align*}
  % drh
  \mathit{drh} \ := \ & \mathit{macro\_def}^* \
  \mathit{variable\_decl}^+ \ \mathit{mode\_def}^+ \  \mathit{initial\_cond} \  \mathit{goal}^+\\
  % variable-decl
  \mathit{macro\_decl} \ := \ &  \texttt{\#define} \ \mathit{var} \ (\mathit{expr} \, | \, \mathit{formula})\\
  % variable-decl
  \mathit{variable\_decl} \ := \ &  \texttt{[} \mathit{l} \texttt{,} \ \mathit{u} \texttt{]} \ \mathit{var} \texttt{;}\\
  % variable-decl
  \mathit{mode\_def} \ := \ & \texttt{\{}
  \texttt{mode} \
  \mathit{id}\texttt{;} \quad
  \texttt{invt}:(\mathit{formula} \texttt{;})^+ \ \ \
  \texttt{flow}:\mathit{ode}^+ \ \ \ \texttt{jump}:\mathit{jump}^+ \texttt{\}}\\
  \mathit{ode} \ := \ & \texttt{d/dt[}\mathit{x}\texttt{]=}\mathit{exp}\\
  \mathit{jump} \ := \ & \mathit{formula} \ \texttt{==>} \ \texttt{@}\mathit{n} \ \mathit{formula}\\
  \mathit{initial\_cond} \ := \ & \texttt{@}\mathit{mode\_id} \ \mathit{formula}\texttt{;}\\
  \mathit{goal}              \ := \ & \texttt{@}\mathit{mode\_id} \ \mathit{formula}\texttt{;}
\end{align*}
Note that we use the standard definitions for $\mathit{formlua}$ and
$\mathit{expr}$ here.
\begin{figure}
  \centering
  \begin{Verbatim}[fontfamily=courier, frame=single, framesep=1mm,
  numbers=left, fontsize=\scriptsize]
#define D 0.45
#define K 0.9
[0, 15] x; [9.8] g; [-18, 18] v; [0, 3] time;
{   mode 1;
    invt: (v <= 0);  (x >= 0);
    flow: d/dt[x] = v; d/dt[v] = -g - (D * v ^ 2);
    jump: (x = 0) ==> @2 (and (x' = x) (v' = - K * v)); }
{   mode 2;
    invt: (v >= 0); (x >= 0);
    flow: d/dt[x] = v; d/dt[v] = -g + (D * v ^ 2);
    jump: (v = 0) ==> @1 (and (x' = x) (v' = v)); }
init: @1 (and (x >= 5) (v = 0));
goal: @1 (and (x >= 0.45));
\end{Verbatim}
\caption{An example of \drh{} format: Inelastic bouncing ball with air
  resistance. At lines 1 and 2, we define a drag coefficient $D = 0.45$
  and an elastic coefficient $K = 0.9$ using \texttt{\#define} macros.
  At line 3, we declare variables $x, g, v,$ and $time$. At lines
  4 - 7 and 8 - 11, we define two modes -- the falling and the
  bouncing-back modes respectively. At line 12, we specify
  that this hybrid system starts at mode 1 (\texttt{@1}) with initial
  condition satisfying $x \ge 5 \land v = 0$. At line 23, it
  is asking whether we can have a trajectory ending at mode 1
  (\texttt{@1}) while the height of the ball is higher than $0.45$.}
\label{fig:bouncing-ball-drh}
\end{figure}

Figure~\ref{fig:bouncing-ball-drh} shows a canonical example of hybrid
systems, an inelastic bouncing ball with air resistance, in \drh{}
format.

\subsection{Command Line Options}
\dReach{} follows the standard unix command-line usage:
\begin{Verbatim}[fontfamily=courier, framesep=1mm, fontsize=\small]
dReach <options> <drh file>
\end{Verbatim}
It has the following options:
\begin{itemize}
\item If \texttt{-k <N>} is used, set the unrolling bound $k$ as $N$ (Default: 3).
\item If \texttt{--precision <p>} is used: use precision $p$ (Default: $0.001$).
\item If \texttt{--visualize} is set, \dReach{} generate extra visualization data.
\end{itemize}
We have a web-based visualization toolkit\footnote{The detailed
  instructions are available at
  \url{https://github.com/dreal/dreal/blob/master/doc/ode-visualization.md}.}
which processes the generated visualization data and shows the
counterexample trajectory. It provides a way to navigate and
zoom-in/out trajectories which helps understand and debug the target
hybrid system better.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
